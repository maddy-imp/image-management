---
- hosts: all
  become: yes
  gather_facts: True
  vars_files:
    - group_vars/vars.yml
  #pre_tasks:
  #- name: Install python for Ansible
  #  raw: test -e /usr/bin/python || (apt -y update && apt install -y python-minimal)

  vars:
    rack: "golden-ami"

  roles:
    - { role: patches_n_updates, tags: ["patches_n_updates"], when: ansible_os_family != "Windows" }
    - { role: dev-sec.os-hardening, tags: ["dev-sec.os-hardening"], when: ansible_os_family != "Windows" }
    #- { role: ssh-hardening, tags: ["ssh-hardening"], when: ansible_os_family != "Windows" }
    - { role: win_patches_n_updates, tags: ["win_patches_n_updates"], when: ansible_os_family == "Windows" }
    #- { role: dev-sec.windows-hardening, tags: ["dev-sec.windows-hardening"], when: ansible_os_family == "Windows"}
    #- { role: email, tags: email }



