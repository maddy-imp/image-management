{
    "variables": {
      "version": "0.0.0",
      "instance_type": "t2.micro",
      "region": "us-east-1",
      "source_ami": "ami-0cfee17793b08a293",
      "access_key": "{{ env `AWS_ACCESS_KEY_ID` }}",
      "secret_key": "{{ env `AWS_SECRET_ACCESS_KEY`}}"
    },
  
    "builders": [
      {
        "type": "amazon-ebs",
        "ami_description": "Golden AMI WIN v{{user `version`}}",
        "ami_name": "Golden AMI WIN {{timestamp}}",
        "associate_public_ip_address": true,
        "user_data_file": "userdata.ps1",
        "communicator": "winrm",
        "instance_type": "{{user `instance_type`}}",
        "region": "{{user `region`}}",
        "winrm_username": "Administrator",
        "winrm_use_ssl": false,
        "winrm_insecure": true,
        "tags": {
          "Name": "Golden AMI WIN v{{user `version`}}"
         },
         "source_ami": "{{user `source_ami`}}"
    }],
  
    "provisioners": [
      {
        "type": "shell-local",
        "command": "ansible-playbook -vvvv -i '127.0.0.1,' -c winrm -T 300 -e \"ansible_user=vagrant ansible_password=vagrant ansible_port=2222 ansible_winrm_scheme=http\" ./ansible/ansible_config.yml"
    }
    ],
    
    "post-processors": [
    {
      "type": "manifest",
      "strip_path": true
    }]
  }