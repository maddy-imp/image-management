{
    "variables": {
      "version": "{{env `BUILD_NUMBER`}}",
      "access_key": "{{ env `AWS_ACCESS_KEY_ID` }}",
      "secret_key": "{{ env `AWS_SECRET_ACCESS_KEY`}}",
      "ansible_roles_path": "./roles:../shared/ansible/roles:../ansible/roles"
    },
  
    "builders": [
      {
        "type": "amazon-ebs",
        "ami_description": "Golden AMI v{{user `version`}}",
        "ami_name": "Golden AMI {{timestamp}}",
        "associate_public_ip_address": true,
        "communicator": "ssh",
        "instance_type": "t2.small",
        "region": "us-east-1",
        "security_group_id": "sg-b62071d2",
        "ssh_keypair_name": "packer_build",
        "ssh_private_key_file": "/var/lib/jenkins/.ssh/packer_build.pem",
        "ssh_private_ip": "true",
        "ssh_pty": "true",
        "ssh_username": "ubuntu",
        "subnet_id": "subnet-7ef02a09",
        "tags": {
          "Name": "Golden AMI v{{user `version`}}"
         },
         "source_ami": "ami-044cdcd8ae90214c4"
    }],
  
    "provisioners": [
      {
        "type": "ansible",
        "playbook_file": "../ansible/ansible_config.yml",
        "user": "ubuntu",
        "ansible_env_vars": [ "ANSIBLE_ROLES_PATH={{user `ansible_roles_path` }}" ]
      }
    ],
    "post-processors": [
    {
      "type": "manifest",
      "output": "packer-manifest.json",
      "strip_path": true
    }]
  }
  
